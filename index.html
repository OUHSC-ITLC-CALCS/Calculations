<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Calculators SPA</title>
  <style>
    :root {
      /* COLOR THEME */
      --hospital-blue: #8B0000;  /* Example: a deep red or any color you like */
      --hospital-accent: #efefef;
      --hospital-bg: #9d979731;
      --text-color: #333;
      --white: #fff;
    }
    /* Ensure all blocks are properly closed and no code is missing above this line. */

    * {
      box-sizing: border-box;
      margin: 0; 
      padding: 0;
    }

    body {
      font-family: Arial, sans-serif;
      background: var(--hospital-bg);
      color: var(--text-color);
    }

    /*******************************************************
     NAVIGATION BAR
    ********************************************************/
    nav {
      background-color: var(--hospital-blue);
      padding: 10px;
    }
    nav a {
      margin: 0 10px;
      text-decoration: none;
      color: var(--white);
      display: inline-block;
      text-align: center;   /* ensures the text below is centered */
      line-height: 1.2;     /* tighter spacing between lines */
    }
    nav a small {
      font-size: 0.75em;    /* smaller font for the subtitle */
      display: block;       /* ensures it appears under DTPA */
    }
    nav a:hover {
      text-decoration: underline;
    }
    nav a.active {
      border-bottom: 2px solid var(--hospital-accent);
      padding-bottom: 2px;
    }

    /*******************************************************
     MAIN CONTAINER (centered card)
    ********************************************************/
    .calculator-container {
      background: var(--white);
      margin: 20px auto;
      padding: 20px;
      max-width: 800px;
      border-radius: 5px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      min-height: 400px;
    }

    /*******************************************************
     HEADINGS
    ********************************************************/
    h2 {
      color: var(--hospital-blue);
      margin-bottom: 10px;
    }

    /*******************************************************
     LABELS & INPUTS
    ********************************************************/
    label {
      display: inline-block;
      width: 150px;
      margin-bottom: 10px;
      font-weight: bold;
    }
    input {
      width: 100px;
      margin-bottom: 10px;
      padding: 4px;
      border: 1px solid #ccc;
      border-radius: 3px;
    }

    /*******************************************************
     OPTIONAL: STRONG TEXT STYLING
    ********************************************************/
    strong {
      color: var(--hospital-blue);
    }

    /*******************************************************
     FIXED FOOTER NOTE (pinned to the bottom left)
    ********************************************************/
    .footer-note-fixed {
      position: fixed;
      bottom: 0;
      left: 0;
      background: var(--white);
      border-top-right-radius: 5px;
      border: 1px solid #ccc;
      padding: 8px 12px;
      margin: 0;
      color: var(--text-color);
      font-size: 0.85rem;
      box-shadow: 0 -2px 6px rgba(0,0,0,0.1);
    }

    /*******************************************************
     TABLE STYLING (for dynamic row entries)
    ********************************************************/
    table {
      border-collapse: collapse;
      width: 100%;
      margin-top: 15px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 6px;
      text-align: center;
    }
  </style>
</head>
<body>
  <nav>
    <a href="#home" id="link-home">Home</a>
    <a href="#calc1" id="link-calc1">
  DTPA<br><small>(Pulmonary Embolism)</small>
</a>
    <a href="#calc2" id="link-calc2">HIDA</a>
    <a href="#calc3" id="link-calc3">MAA</a>
    <a href="#calc4" id="link-calc4">MDP</a>
    <a href="#calc5" id="link-calc5">RBC</a>
  </nav>

  <div class="calculator-container" id="calculator-container">
    <!-- Dynamic content will load here -->
  </div>

  <!-- PINNED FOOTER NOTE -->
  <div class="footer-note-fixed">
    Developed by Michael H. Jones, B.S.
  </div>

  <script>
    /*******************************************************
     GLOBAL VARIABLES FOR REPORTING TABLES
    ********************************************************/
    // DTPA globals
    let dtpaSampleCount      = 1;
    let dtpaStoredBackground = null;
  
    // HIDA globals
    let hidSampleCount       = 1;
    let hidStoredBackground  = null;
  
    // MAA globals
    let maaSampleCount       = 1;
    let maaStoredBackground  = null;
  
    // MDP globals
    let mdpSampleCount       = 1;
    let mdpStoredBackground  = null;
  
    // RBC globals
    let rbcSampleCount       = 1;
    let rbcStoredBackground  = null;
  
    // ==========================
    //  RENDER FUNCTIONS
    // ==========================
    function renderHome() {
      return `
        <h2>Welcome!</h2>
        <p>Select a calculator from the navigation above.</p>
        <p>
          This site helps you calculate percent yields 
          for various radiopharmaceutical QC tests.
        </p>
      `;
    }
  
    /*******************************************************
     1) DTPA CALCULATOR
       - Includes: input fields, Enter button, and dynamic reporting table.
    ********************************************************/
    function renderCalc1() {
      return `
        <h2 style="text-align:center;">DTPA<br><small>(Pulmonary Embolism)</small></h2>
        <!-- INPUT FIELDS -->
      <div>
        <label for="dtpaBackground">Background (cpm):</label>
       <input type="number" id="dtpaBackground" value="0" />
       </div>
      <div>
        <label for="dtpaSalineOrigin">Saline Origin (cpm):</label>
        <input type="number" id="dtpaSalineOrigin" value="0" />
        </div>
        <div>
          <label for="dtpaSalineFront">Saline Front (cpm):</label>
          <input type="number" id="dtpaSalineFront" value="0" />
        </div>
        <div>
          <label for="dtpaMekOrigin">MEK Origin (cpm):</label>
          <input type="number" id="dtpaMekOrigin" value="0" />
        </div>
        <div>
          <label for="dtpaMekFront">MEK Front (cpm):</label>
          <input type="number" id="dtpaMekFront" value="0" />
        </div>
          <!-- REAL-TIME DISPLAY (Optional) -->
          <br />
        <div><strong>Total Saline (counts):</strong> <span id="dtpaTotalSaline">0</span></div>
        <div><strong>Total MEK (counts):</strong> <span id="dtpaTotalMek">0</span></div>
        <div><strong>% Hydrolyzed Reduced [TcO₂]:</strong> <span id="dtpaPercentHydrolyzed">0</span></div>
        <div><strong>% Pertechnetate [TcO₄⁻]:</strong> <span id="dtpaPercentPertechnetate">0</span></div>
        <div><strong>% DTPA Labeled:</strong> <span id="dtpaPercentComplexLabeled">0</span></div>
          <!-- SUBMIT BUTTON -->
          <br />
          <button id="dtpaEnterBtn">Enter</button>
          <!-- REPORTING TABLE -->
        <table>
          <thead>
          <tr>
            <th>Sample (#)</th>
            <th>Saline Sum (counts)</th>
            <th>MEK Sum (counts)</th>
            <th>% H/R [TcO₂]</th>
            <th>% Pertechnetate [TcO₄⁻]</th>
            <th>% DTPA</th>
            </tr>
          </thead>
            <tbody id="dtpaTableBody"></tbody>
          </table>
          <!-- NOTE SECTION -->
        <div style="margin-top:20px; text-align:center; font-style:italic; color:#555;">
      Purpose: Distribution of aerosolized DTPA shows where the patient is ventilating (air is reaching the alveoli).
      Clinical Implication: Assessment of ventilation-perfusion (V/Q) mismatch in patients suspected of having a pulmonary embolism.
    </div>
      `;
    }
  
    /*******************************************************
     2) HIDA CALCULATOR
       - Includes: input fields, Enter button, and dynamic reporting table.
    ********************************************************/
    function renderCalc2() {
      return `
        <h2>HIDA Percent Yield Calculator</h2>
        <!-- INPUT FIELDS -->
        <div>
          <label for="hidaBackground">Background (cpm):</label>
          <input type="number" id="hidaBackground" value="0" />
        </div>
        <div>
          <label for="hidaWaterOrigin">Water Origin (cpm):</label>
          <input type="number" id="hidaWaterOrigin" value="0" />
        </div>
        <div>
          <label for="hidaWaterFront">Water Front (cpm):</label>
          <input type="number" id="hidaWaterFront" value="0" />
        </div>
        <div>
          <label for="hidaSalineOrigin">Sat. Saline Origin (cpm):</label>
          <input type="number" id="hidaSalineOrigin" value="0" />
        </div>
        <div>
          <label for="hidaSalineFront">Sat. Saline Front (cpm):</label>
          <input type="number" id="hidaSalineFront" value="0" />
        </div>
        <!-- REAL-TIME DISPLAY (Optional) -->
        <br />
        <div><strong>Total Water (counts):</strong> <span id="hidaTotalWater">0</span></div>
        <div><strong>Total Sat. Saline (counts):</strong> <span id="hidaTotalSaline">0</span></div>
        <div><strong>% Hydrolyzed Reduced [TcO₂]:</strong> <span id="hidaPercentHydrolyzed">0</span></div>
        <div><strong>% Pertechnetate [TcO₄⁻]:</strong> <span id="hidaPercentPertechnetate">0</span></div>
        <div><strong>% HIDA Labeled:</strong> <span id="hidaPercentComplexLabeled">0</span></div>
        <!-- SUBMIT BUTTON -->
        <br />
        <button id="hidaEnterBtn">Enter</button>
        <!-- REPORTING TABLE -->
        <table>
          <thead>
            <tr>
              <th>Sample (#)</th>
              <th>Total Water (counts)</th>
              <th>Total Sat. Saline (counts)</th>
              <th>% H/R [TcO₂]</th>
              <th>% Pertechnetate [TcO₄⁻]</th>
              <th>% HIDA Labeled</th>
            </tr>
          </thead>
          <tbody id="hidaTableBody"></tbody>
        </table>
      `;
    }
  
    /*******************************************************
     3) MAA CALCULATOR
       - Includes: input fields, Enter button, and dynamic reporting table.
    ********************************************************/
    function renderCalc3() {
      return `
        <h2>MAA Percent Yield Calculator</h2>
        <!-- INPUT FIELDS -->
        <div>
          <label for="background">Background (cpm):</label>
          <input type="number" id="background" value="0" />
        </div>
        <div>
          <label for="origin">Origin (cpm):</label>
          <input type="number" id="origin" value="0" />
        </div>
        <div>
          <label for="solventFront">Solvent Front (cpm):</label>
          <input type="number" id="solventFront" value="0" />
        </div>
        <!-- REAL-TIME DISPLAY (Optional) -->
        <br/>
        <div><strong>Total Counts:</strong> <span id="totalCounts">0</span></div>
        <div><strong>% MAA Labeled:</strong> <span id="percentComplexed">0</span></div>
        <!-- SUBMIT BUTTON -->
        <br />
        <button id="maaEnterBtn">Enter</button>
        <!-- REPORTING TABLE -->
        <table>
          <thead>
            <tr>
              <th>Sample (#)</th>
              <th>Total Counts</th>
              <th>% MAA Labeled</th>
            </tr>
          </thead>
          <tbody id="maaTableBody"></tbody>
        </table>
      `;
    }
  
    /*******************************************************
     4) MDP CALCULATOR
       - Includes: input fields, Enter button, and dynamic reporting table.
    ********************************************************/
    function renderCalc4() {
      return `
        <h2>MDP Percent Yield Calculator</h2>
        <!-- INPUT FIELDS -->
        <div>
          <label for="sgBackground">Background (cpm):</label>
          <input type="number" id="sgBackground" value="0" />
        </div>
        <div>
          <label for="sgSalineOrigin">Saline Origin (cpm):</label>
          <input type="number" id="sgSalineOrigin" value="0" />
        </div>
        <div>
          <label for="sgSalineFront">Saline Solvent Front (cpm):</label>
          <input type="number" id="sgSalineFront" value="0" />
        </div>
        <div>
          <label for="sgAcetoneOrigin">Acetone Origin (cpm):</label>
          <input type="number" id="sgAcetoneOrigin" value="0" />
        </div>
        <div>
          <label for="sgAcetoneFront">Acetone Solvent Front (cpm):</label>
          <input type="number" id="sgAcetoneFront" value="0" />
        </div>
        <!-- REAL-TIME DISPLAY (Optional) -->
        <br />
        <div><strong>Total Saline (counts):</strong> <span id="totalSaline">0</span></div>
        <div><strong>Total Acetone (counts):</strong> <span id="totalAcetone">0</span></div>
        <div><strong>% Hydrolyzed Reduced [TcO₂]:</strong> <span id="percentHydrolyzed">0</span></div>
        <div><strong>% Pertechnetate [TcO₄⁻]:</strong> <span id="percentPertechnetate">0</span></div>
        <div><strong>% MDP Labeled:</strong> <span id="percentComplexLabeled">0</span></div>
        <!-- SUBMIT BUTTON -->
        <br />
        <button id="mdpEnterBtn">Enter</button>
        <!-- REPORTING TABLE -->
        <table>
          <thead>
            <tr>
              <th>Sample (#)</th>
              <th>Total Saline (counts)</th>
              <th>Total Acetone (counts)</th>
              <th>% H/R [TcO₂]</th>
              <th>% Pertechnetate [TcO₄⁻]</th>
              <th>% MDP Labeled</th>
            </tr>
          </thead>
          <tbody id="mdpTableBody"></tbody>
        </table>
      `;
    }
  
    /*******************************************************
     5) RBC CALCULATOR
       - Uses the same calculation logic as the MAA calculator
       - Includes: input fields, Enter button, and dynamic reporting table.
    ********************************************************/
    function renderCalc5() {
      return `
        <h2>RBC Percent Yield Calculator</h2>
        <!-- INPUT FIELDS -->
        <div>
          <label for="rbcBackground">Background (cpm):</label>
          <input type="number" id="rbcBackground" value="0" />
        </div>
        <div>
          <label for="rbcOrigin">Origin (cpm):</label>
          <input type=" number" id="rbcOrigin" value="0" />
        </div>
        <div>
          <label for="rbcSolventFront">Solvent Front (cpm):</label>
          <input type="number" id="rbcSolventFront" value="0" />
        </div>
        <!-- REAL-TIME DISPLAY (Optional) -->
        <br/>
        <div><strong>Total Counts:</strong> <span id="rbcTotalCounts">0</span></div>
        <div><strong>% RBC Labeled:</strong> <span id="rbcPercentComplexed">0</span></div>
        <!-- SUBMIT BUTTON -->
        <br />
        <button id="rbcEnterBtn">Enter</button>
        <!-- REPORTING TABLE -->
        <table>
          <thead>
            <tr>
              <th>Sample (#)</th>
              <th>Total Counts</th>
              <th>% RBC Labeled</th>
            </tr>
          </thead>
          <tbody id="rbcTableBody"></tbody>
        </table>
      `;
    }
  
    // ==========================
    //  ROUTER
    // ==========================
    function router() {
      const container = document.getElementById('calculator-container');
      const hash = window.location.hash || '#home';
  
      // Remove “active” from all links
      document.querySelectorAll('nav a').forEach(link => link.classList.remove('active'));
  
      let content = '';
      switch (hash) {
        case '#calc1':
          content = renderCalc1();
          document.getElementById('link-calc1').classList.add('active');
          break;
        case '#calc2':
          content = renderCalc2();
          document.getElementById('link-calc2').classList.add('active');
          break;
        case '#calc3':
          content = renderCalc3();
          document.getElementById('link-calc3').classList.add('active');
          break;
        case '#calc4':
          content = renderCalc4();
          document.getElementById('link-calc4').classList.add('active');
          break;
        case '#calc5':
          content = renderCalc5();
          document.getElementById('link-calc5').classList.add('active');
          break;
        default:
          content = renderHome();
          document.getElementById('link-home').classList.add('active');
      }
  
      container.innerHTML = content;
      attachEventListeners(hash);
    }
  
    // ==========================
    //  EVENT LISTENERS
    // ==========================
    function attachEventListeners(hash) {
  
      /*******************************************************
       1) DTPA CALCULATOR (DYNAMIC TABLE + LOCKED BACKGROUND)
      ********************************************************/
      if (hash === '#calc1') {
        const bgInput            = document.getElementById('dtpaBackground');
        const salineOriginInput  = document.getElementById('dtpaSalineOrigin');
        const salineFrontInput   = document.getElementById('dtpaSalineFront');
        const mekOriginInput     = document.getElementById('dtpaMekOrigin');
        const mekFrontInput      = document.getElementById('dtpaMekFront');
  
        const totalSalineSpan        = document.getElementById('dtpaTotalSaline');
        const totalMekSpan           = document.getElementById('dtpaTotalMek');
        const percentHydrolyzedSpan  = document.getElementById('dtpaPercentHydrolyzed');
        const percentPertechnetateSpan = document.getElementById('dtpaPercentPertechnetate');
        const percentComplexSpan     = document.getElementById('dtpaPercentComplexLabeled');
  
        const dtpaEnterBtn = document.getElementById('dtpaEnterBtn');
        const dtpaTableBody = document.getElementById('dtpaTableBody');
  
        function recalcDTPA() {
          let background = dtpaStoredBackground;
          if (dtpaSampleCount === 1) {
            background = parseFloat(bgInput.value) || 0;
          } else if (dtpaStoredBackground !== null) {
            bgInput.value = dtpaStoredBackground;
          }
  
          const salineOrigin = parseFloat(salineOriginInput.value) || 0;
          const salineFront  = parseFloat(salineFrontInput.value)  || 0;
          const mekOrigin    = parseFloat(mekOriginInput.value)    || 0;
          const mekFront     = parseFloat(mekFrontInput.value)     || 0;
  
          const totalSalineVal = (salineOrigin - background) + (salineFront - background);
          totalSalineSpan.textContent = totalSalineVal.toFixed(1);
  
          const totalMekVal = (mekOrigin - background) + (mekFront - background);
          totalMekSpan.textContent = totalMekVal.toFixed(1);
  
          let percentHydrolyzed = 0;
          const salineSum = salineOrigin + salineFront;
          if (salineSum !== 0) {
            percentHydrolyzed = (salineOrigin / salineSum) * 100;
          }
          let percentPertechnetate = 0;
          const mekSum = mekOrigin + mekFront;
          if (mekSum !== 0) {
            percentPertechnetate = (mekFront / mekSum) * 100;
          }
          const percentComplex = 100 - (percentHydrolyzed + percentPertechnetate);
  
          percentHydrolyzedSpan.textContent    = percentHydrolyzed.toFixed(1);
          percentPertechnetateSpan.textContent = percentPertechnetate.toFixed(1);
          percentComplexSpan.textContent       = percentComplex.toFixed(1);
        }
  
        [bgInput, salineOriginInput, salineFrontInput, mekOriginInput, mekFrontInput]
          .forEach(input => input.addEventListener('input', recalcDTPA));
  
        recalcDTPA();
  
        dtpaEnterBtn.addEventListener('click', function() {
          if (dtpaSampleCount === 1) {
            dtpaStoredBackground = parseFloat(bgInput.value) || 0;
          }
          const background = dtpaStoredBackground;
          const salineOrigin = parseFloat(salineOriginInput.value) || 0;
          const salineFront  = parseFloat(salineFrontInput.value)  || 0;
          const mekOrigin    = parseFloat(mekOriginInput.value)    || 0;
          const mekFront     = parseFloat(mekFrontInput.value)     || 0;
  
          const totalSalineVal = (salineOrigin - background) + (salineFront - background);
          const totalMekVal = (mekOrigin - background) + (mekFront - background);
  
          let percentHydrolyzed = 0;
          const salineSum = salineOrigin + salineFront;
          if (salineSum !== 0) {
            percentHydrolyzed = (salineOrigin / salineSum) * 100;
          }
          let percentPertechnetate = 0;
          const mekSum = mekOrigin + mekFront;
          if (mekSum !== 0) {
            percentPertechnetate = (mekFront / mekSum) * 100;
          }
          const percentComplex = 100 - (percentHydrolyzed + percentPertechnetate);
  
          // Build a new row
          const row = document.createElement('tr');
  
          const sampleCell = document.createElement('td');
          sampleCell.textContent = dtpaSampleCount;
          row.appendChild(sampleCell);
  
          const salineCell = document.createElement('td');
          salineCell.textContent = totalSalineVal.toFixed(1);
          row.appendChild(salineCell);
  
          const mekCell = document.createElement('td');
          mekCell.textContent = totalMekVal.toFixed(1);
          row.appendChild(mekCell);
  
          const hydroCell = document.createElement('td');
          hydroCell.textContent = percentHydrolyzed.toFixed(1);
          row.appendChild(hydroCell);
  
          const pertecCell = document.createElement('td');
          pertecCell.textContent = percentPertechnetate.toFixed(1);
          row.appendChild(pertecCell);
  
          const dtpaCell = document.createElement('td');
          dtpaCell.textContent = percentComplex.toFixed(1);
          row.appendChild(dtpaCell);
  
          dtpaTableBody.appendChild(row);
  
          dtpaSampleCount++;
          bgInput.value = dtpaStoredBackground;
          salineOriginInput.value = '';
          salineFrontInput.value = '';
          mekOriginInput.value = '';
          mekFrontInput.value = '';
  
          recalcDTPA();
        });
      }
  
      /*******************************************************
       2) HIDA CALCULATOR (DYNAMIC TABLE + LOCKED BACKGROUND)
      ********************************************************/
      else if (hash === '#calc2') {
        const bgInput            = document.getElementById('hidaBackground');
        const waterOriginInput   = document.getElementById('hidaWaterOrigin');
        const waterFrontInput    = document.getElementById('hidaWaterFront');
        const salineOriginInput  = document.getElementById('hidaSalineOrigin');
        const salineFrontInput   = document.getElementById('hidaSalineFront');
  
        const totalWaterSpan        = document.getElementById('hidaTotalWater');
        const totalSalineSpan       = document.getElementById('hidaTotalSaline');
        const percentHydrolyzedSpan = document.getElementById('hidaPercentHydrolyzed');
        const percentPertechnetateSpan = document.getElementById('hidaPercentPertechnetate');
        const percentComplexSpan    = document.getElementById('hidaPercentComplexLabeled');
  
        const hidEnterBtn = document.getElementById('hidaEnterBtn');
        const hidTableBody = document.getElementById('hidaTableBody');
  
        function recalcHIDA() {
          let background = hidStoredBackground;
          if (hidSampleCount === 1) {
            background = parseFloat(bgInput.value) || 0;
          } else if (hidStoredBackground !== null) {
            bgInput.value = hidStoredBackground;
          }
  
          const waterOrigin = parseFloat(waterOriginInput.value) || 0;
          const waterFront  = parseFloat(waterFrontInput.value)  || 0;
          const salineOrigin = parseFloat(salineOriginInput.value) || 0;
          const salineFront  = parseFloat(salineFrontInput.value)  || 0;
  
          const totalWaterVal  = (waterOrigin - background) + (waterFront - background);
          totalWaterSpan.textContent = totalWaterVal.toFixed(1);
  
          const totalSalineVal = (salineOrigin - background) + (salineFront - background);
          totalSalineSpan.textContent = totalSalineVal.toFixed(1);
  
          let percentHydrolyzed = 0;
          const waterSum = waterOrigin + waterFront;
          if (waterSum !== 0) {
            percentHydrolyzed = (waterOrigin / waterSum) * 100;
          }
          let percentPertechnetate = 0;
          const salineSum = salineOrigin + salineFront;
          if (salineSum !== 0) {
            percentPertechnetate = (salineFront / salineSum) * 100;
          }
          const percentComplex = 100 - (percentHydrolyzed + percentPertechnetate);
  
          percentHydrolyzedSpan.textContent    = percentHydrolyzed.toFixed(1);
          percentPertechnetateSpan.textContent = percentPertechnetate.toFixed(1);
          percentComplexSpan.textContent       = percentComplex.toFixed(1);
        }
  
        [bgInput, waterOriginInput, waterFrontInput, salineOriginInput, salineFrontInput]
          .forEach(input => input.addEventListener('input', recalcHIDA));
  
        recalcHIDA();
  
        hidEnterBtn.addEventListener('click', function() {
          if (hidSampleCount === 1) {
            hidStoredBackground = parseFloat(bgInput.value) || 0;
          }
          const background = hidStoredBackground;
          const waterOrigin = parseFloat(waterOriginInput.value) || 0;
          const waterFront  = parseFloat(waterFrontInput.value)  || 0;
          const salineOrigin = parseFloat(salineOriginInput.value) || 0;
          const salineFront  = parseFloat(salineFrontInput.value)  || 0;
  
          const totalWaterVal  = (waterOrigin - background) + (waterFront - background);
          const totalSalineVal = (salineOrigin - background) + (salineFront - background);
  
          let percentHydrolyzed = 0;
          const waterSum = waterOrigin + waterFront;
          if (waterSum !== 0) {
            percentHydrolyzed = (waterOrigin / waterSum) * 100;
          }
          let percentPertechnetate = 0;
          const salineSum = salineOrigin + salineFront;
          if (salineSum !== 0) {
            percentPertechnetate = (salineFront / salineSum) * 100;
          }
          const percentComplex = 100 - (percentHydrolyzed + percentPertechnetate);
  
          const row = document.createElement('tr');
  
          const sampleCell = document.createElement('td');
          sampleCell.textContent = hidSampleCount;
          row.appendChild(sampleCell);
  
          const waterCell = document.createElement('td');
          waterCell.textContent = totalWaterVal.toFixed(1);
          row.appendChild(waterCell);
  
          const salineCell = document.createElement('td');
          salineCell.textContent = totalSalineVal.toFixed(1);
          row.appendChild(salineCell);
  
          const hydroCell = document.createElement('td');
          hydroCell.textContent = percentHydrolyzed.toFixed(1);
          row.appendChild(hydroCell);
  
          const pertecCell = document.createElement('td');
          pertecCell.textContent = percentPertechnetate.toFixed(1);
          row.appendChild(pertecCell);
  
          const hadaCell = document.createElement('td');
          hadaCell.textContent = percentComplex.toFixed(1);
          row.appendChild(hadaCell);
  
          hidTableBody.appendChild(row);
  
          hidSampleCount++;
          bgInput.value = hidStoredBackground;
          waterOriginInput.value = '';
          waterFrontInput.value = '';
          salineOriginInput.value = '';
          salineFrontInput.value = '';
  
          recalcHIDA();
        });
      }
  
      /*******************************************************
       3) MAA CALCULATOR (DYNAMIC TABLE + LOCKED BACKGROUND)
      ********************************************************/
      else if (hash === '#calc3') {
        const backgroundInput   = document.getElementById('background');
        const originInput       = document.getElementById('origin');
        const solventFrontInput = document.getElementById('solventFront');
  
        const totalCountsSpan      = document.getElementById('totalCounts');
        const percentComplexedSpan = document.getElementById('percentComplexed');
  
        const maaEnterBtn = document.getElementById('maaEnterBtn');
        const maaTableBody = document.getElementById('maaTableBody');
  
        function recalcMAA() {
          let background = maaStoredBackground;
          if (maaSampleCount === 1) {
            background = parseFloat(backgroundInput.value) || 0;
          } else if (maaStoredBackground !== null) {
            backgroundInput.value = maaStoredBackground;
          }
  
          const originVal       = parseFloat(originInput.value)       || 0;
          const solventFrontVal = parseFloat(solventFrontInput.value) || 0;
  
          const totalCountsVal = (originVal - background) + (solventFrontVal - background);
          totalCountsSpan.textContent = totalCountsVal.toFixed(1);
  
          let percentComplexed = 0;
          if (totalCountsVal !== 0) {
            percentComplexed = ((originVal - background) / totalCountsVal) * 100;
          }
          percentComplexedSpan.textContent = percentComplexed.toFixed(1);
        }
  
        [backgroundInput, originInput, solventFrontInput]
          .forEach(input => input.addEventListener('input', recalcMAA));
  
        recalcMAA();
  
        maaEnterBtn.addEventListener('click', function() {
          if (maaSampleCount === 1) {
            maaStoredBackground = parseFloat(backgroundInput.value) || 0;
          }
          const background = maaStoredBackground;
          const originVal       = parseFloat(originInput.value)       || 0;
          const solventFrontVal = parseFloat(solventFrontInput.value) || 0;
  
          const totalCountsVal = (originVal - background) + (solventFrontVal - background);
          let percentComplexed = 0;
          if (totalCountsVal !== 0) {
            percentComplexed = ((originVal - background) / totalCountsVal) * 100;
          }
  
          const row = document.createElement('tr');
  
          const sampleCell = document.createElement('td');
          sampleCell.textContent = maaSampleCount;
          row.appendChild(sampleCell);
  
          const countsCell = document.createElement('td');
          countsCell.textContent = totalCountsVal.toFixed(1);
          row.appendChild(countsCell);
  
          const complexedCell = document.createElement('td');
          complexedCell.textContent = percentComplexed.toFixed(1);
          row.appendChild(complexedCell);
  
          maaTableBody.appendChild(row);
  
          maaSampleCount++;
          backgroundInput.value = maaStoredBackground;
          originInput.value = '';
          solventFrontInput.value = '';
  
          recalcMAA();
        });
      }
  
      /*******************************************************
       4) MDP CALCULATOR (DYNAMIC TABLE + LOCKED BACKGROUND)
      ********************************************************/
      else if (hash === '#calc4') {
        const bgInput             = document.getElementById('sgBackground');
        const salineOriginInput   = document.getElementById('sgSalineOrigin');
        const salineFrontInput    = document.getElementById('sgSalineFront');
        const acetoneOriginInput  = document.getElementById('sgAcetoneOrigin');
        const acetoneFrontInput   = document.getElementById('sgAcetoneFront');
  
        const totalSalineSpan        = document.getElementById('totalSaline');
        const totalAcetoneSpan       = document.getElementById('totalAcetone');
        const percentHydrolyzedSpan  = document.getElementById('percentHydrolyzed');
        const percentPertechnetateSpan = document.getElementById('percentPertechnetate');
        const percentComplexSpan     = document.getElementById('percentComplexLabeled');
  
        const mdpEnterBtn = document.getElementById('mdpEnterBtn');
        const mdpTableBody = document.getElementById('mdpTableBody');
  
        function recalcMDP() {
          let background = mdpStoredBackground;
          if (mdpSampleCount === 1) {
            background = parseFloat(bgInput.value) || 0;
          } else if (mdpStoredBackground !== null) {
            bgInput.value = mdpStoredBackground;
          }
  
          const salineOriginVal  = parseFloat(salineOriginInput.value)  || 0;
          const salineFrontVal   = parseFloat(salineFrontInput.value)   || 0;
          const acetoneOriginVal = parseFloat(acetoneOriginInput.value) || 0;
          const acetoneFrontVal  = parseFloat(acetoneFrontInput.value)  || 0;
  
          const totalSalineVal  = (salineOriginVal - background) + (salineFrontVal - background);
          totalSalineSpan.textContent = totalSalineVal.toFixed(1);
  
          const totalAcetoneVal = (acetoneOriginVal - background) + (acetoneFrontVal - background);
          totalAcetoneSpan.textContent = totalAcetoneVal.toFixed(1);
  
          let percentHydrolyzed = 0;
          const salineSum = salineOriginVal + salineFrontVal;
          if (salineSum !== 0) {
            percentHydrolyzed = (salineOriginVal / salineSum) * 100;
          }
          let percentPertechnetate = 0;
          const acetoneSum = acetoneOriginVal + acetoneFrontVal;
          if (acetoneSum !== 0) {
            percentPertechnetate = (acetoneFrontVal / acetoneSum) * 100;
          }
          const percentComplex = 100 - (percentHydrolyzed + percentPertechnetate);
  
          percentHydrolyzedSpan.textContent    = percentHydrolyzed.toFixed(1);
          percentPertechnetateSpan.textContent = percentPertechnetate.toFixed(1);
          percentComplexSpan.textContent       = percentComplex.toFixed(1);
        }
  
        [bgInput, salineOriginInput, salineFrontInput, acetoneOriginInput, acetoneFrontInput]
          .forEach(input => input.addEventListener('input', recalcMDP));
  
        recalcMDP();
  
        mdpEnterBtn.addEventListener('click', function() {
          if (mdpSampleCount === 1) {
            mdpStoredBackground = parseFloat(bgInput.value) || 0;
          }
          const background      = mdpStoredBackground;
          const salineOriginVal  = parseFloat(salineOriginInput.value)  || 0;
          const salineFrontVal   = parseFloat(salineFrontInput.value)   || 0;
          const acetoneOriginVal = parseFloat(acetoneOriginInput.value) || 0;
          const acetoneFrontVal  = parseFloat(acetoneFrontInput.value)  || 0;
  
          const totalSalineVal  = (salineOriginVal - background) + (salineFrontVal - background);
          const totalAcetoneVal = (acetoneOriginVal - background) + (acetoneFrontVal - background);
  
          let percentHydrolyzed = 0;
          const salineSum = salineOriginVal + salineFrontVal;
          if (salineSum !== 0) {
            percentHydrolyzed = (salineOriginVal / salineSum) * 100;
          }
          let percentPertechnetate = 0;
          const acetoneSum = acetoneOriginVal + acetoneFrontVal;
          if (acetoneSum !== 0) {
            percentPertechnetate = (acetoneFrontVal / acetoneSum) * 100;
          }
          const percentComplex = 100 - (percentHydrolyzed + percentPertechnetate);
  
          const row = document.createElement('tr');
  
          const sampleCell = document.createElement('td');
          sampleCell.textContent = mdpSampleCount;
          row.appendChild(sampleCell);
  
          const salineCell = document.createElement('td');
          salineCell.textContent = totalSalineVal.toFixed(1);
          row.appendChild(salineCell);
  
          const acetoneCell = document.createElement('td');
          acetoneCell.textContent = totalAcetoneVal.toFixed(1);
          row.appendChild(acetoneCell);
  
          const hydroCell = document.createElement('td');
          hydroCell.textContent = percentHydrolyzed.toFixed(1);
          row.appendChild(hydroCell);
  
          const pertecCell = document.createElement('td');
          pertecCell.textContent = percentPertechnetate.toFixed(1);
          row.appendChild(pertecCell);
  
          const mdpCell = document.createElement('td');
          mdpCell.textContent = percentComplex.toFixed(1);
          row.appendChild(mdpCell);
  
          mdpTableBody.appendChild(row);
  
          mdpSampleCount++;
          bgInput.value = mdpStoredBackground;
          salineOriginInput.value = '';
          salineFrontInput.value = '';
          acetoneOriginInput.value = '';
          acetoneFrontInput.value = '';
  
          recalcMDP();
        });
      }
  
      /*******************************************************
       5) RBC CALCULATOR (DYNAMIC TABLE + LOCKED BACKGROUND)
      ********************************************************/
      else if (hash === '#calc5') {
        const backgroundInput   = document.getElementById('rbcBackground');
        const originInput       = document.getElementById('rbcOrigin');
        const solventFrontInput = document.getElementById('rbcSolventFront');
  
        const totalCountsSpan      = document.getElementById('rbcTotalCounts');
        const percentComplexedSpan = document.getElementById('rbcPercentComplexed');
  
        const rbcEnterBtn = document.getElementById('rbcEnterBtn');
        const rbcTableBody = document.getElementById('rbcTableBody');
  
        function recalcRBC() {
          let background = rbcStoredBackground;
          if (rbcSampleCount === 1) {
            background = parseFloat(backgroundInput.value) || 0;
          } else if (rbcStoredBackground !== null) {
            backgroundInput.value = rbcStoredBackground;
          }
  
          const originVal       = parseFloat(originInput.value)       || 0;
          const solventFrontVal = parseFloat(solventFrontInput.value) || 0;
  
          const totalCountsVal = (originVal - background) + (solventFrontVal - background);
          totalCountsSpan.textContent = totalCountsVal.toFixed(1);
  
          let percentComplexed = 0;
          if (totalCountsVal !== 0) {
            percentComplexed = ((originVal - background) / totalCountsVal) * 100;
          }
          percentComplexedSpan.textContent = percentComplexed.toFixed(1);
        }
  
        [backgroundInput, originInput, solventFrontInput]
          .forEach(input => input.addEventListener('input', recalcRBC));
  
        recalcRBC();
  
        rbcEnterBtn.addEventListener('click', function() {
          if (rbcSampleCount === 1) {
            rbcStoredBackground = parseFloat(backgroundInput.value) || 0;
          }
          const background      = rbcStoredBackground;
          const originVal       = parseFloat(originInput.value)       || 0;
          const solventFrontVal = parseFloat(solventFrontInput.value) || 0;
  
          const totalCountsVal = (originVal - background) + (solventFrontVal - background);
          let percentComplexed = 0;
          if (totalCountsVal !== 0) {
            percentComplexed = ((originVal - background) / totalCountsVal) * 100;
          }
  
          const row = document.createElement('tr');
  
          const sampleCell = document.createElement('td');
          sampleCell.textContent = rbcSampleCount;
          row.appendChild(sampleCell);
  
          const countsCell = document.createElement('td');
          countsCell.textContent = totalCountsVal.toFixed(1);
          row.appendChild(countsCell);
  
          const complexedCell = document.createElement('td');
          complexedCell.textContent = percentComplexed.toFixed(1);
          row.appendChild(complexedCell);
  
          rbcTableBody.appendChild(row);
  
          rbcSampleCount++;
          backgroundInput.value = rbcStoredBackground;
          originInput.value = '';
          solventFrontInput.value = '';
  
          recalcRBC();
        });
      }
    }
  
    // Attach router to hash‐change and initial load
    window.addEventListener('hashchange', router);
    window.addEventListener('DOMContentLoaded', router);
  </script>
<!DOCTYPE html>
<html lang="en">
  

